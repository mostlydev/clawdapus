FROM node:24-bookworm-slim

RUN apt-get update && apt-get install -y \
    bash ca-certificates cron curl git jq tini \
    && rm -rf /var/lib/apt/lists/*

RUN npm install -g openclaw@2026.2.9

CLAW_TYPE openclaw
AGENT AGENTS.md

MODEL primary openrouter/anthropic/claude-sonnet-4
MODEL fallback openrouter/moonshotai/kimi-k2.5

HANDLE discord
CONFIGURE openclaw config set channels.discord.accounts [{"token":"${DISCORD_BOT_TOKEN}","applicationId":"${DISCORD_APP_ID}"}]
CONFIGURE openclaw config set agents.defaults.bindings.discord.accountId ${DISCORD_APP_ID}
CONFIGURE openclaw config set agents.defaults.heartbeat.target discord

TRACK apt npm

PRIVILEGE worker root
PRIVILEGE runtime claw-user

COPY entrypoint.sh /claw/entrypoint.sh
RUN chmod +x /claw/entrypoint.sh
ENTRYPOINT ["/usr/bin/tini", "--", "/claw/entrypoint.sh"]
